<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>智能车监管大数据平台</title>
    <!--设置是否为缩放模式 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" type="text/css" href="bootstrap/3.3.4/css/bootstrap.css">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <!-- <script src="js/jquery.min.js"></script> -->
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script> -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="js/bootstrap.min.js"></script>

    <!-- 弹出式窗口 -->
    <link rel="stylesheet" type="text/css" href="css/default.css" />
    <link rel="stylesheet" type="text/css" href="css/component.css" />
    <script src="js/modernizr.custom.js"></script>

    <!-- 服务器配置 -->
    <script src="js/server.js"></script>

    <!--echarts JS-->
    <!-- <script src="js/echarts.min.js"></script> -->
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.js"></script>

    <!-- 轮播swiper文件 -->
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css">
    <script src="js/swiper.min.js"></script>

    <!--界面样式-->
    <script src="js/visual.js"></script>
    <script src="js/china.js"></script>
    <!-- <script src="js/xiamen.js"></script> -->
    <script src="js/chartMap.js"></script>
    <link rel="stylesheet" type="text/css" href="css/visual.css">

    <!-- semantic UI -->
    <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/icon.css" rel="stylesheet">
    <!-- <link href="https://cdn.bootcss.com/semantic-ui/2.4.1/components/icon.css" rel="stylesheet"> -->
    <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/button.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/transition.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/transition.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/button.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/semantic-ui/2.4.1/components/icon.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/dropdown.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.4.1/components/dropdown.css" rel="stylesheet">


    <!-- semantic的下拉菜单不能反色，用formantic -->
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/fomantic-ui/2.8.7/components/dropdown.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/fomantic-ui/2.8.7/components/dropdown.css" rel="stylesheet"> -->


    <!-- 百度地图 -->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=NjvQlGFSxuq5B7ld8vdIWwuGfdy2sTsq"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.0&type=webgl&ak=NjvQlGFSxuq5B7ld8vdIWwuGfdy2sTsq"></script>
        <!-- 百度地图绘图需要的css，存在跨域问题，所以手动复制下来作为静态资源提供 -->
    <link rel="stylesheet" type="text/css" href="css/bmap.css">

    <!-- 容器反转 -->
    <link rel="stylesheet" type="text/css" href="css/flip.css">
    <script src="js/flip.js"></script>

    <!-- echarts 绘图脚本 -->
    <script src="js/charts.js"></script>

    <!-- 数据请求脚本 -->
    <script src="js/dashboard.js"></script>
    <script src="js/scoreboard.js"></script>

    <!-- 时钟 -->
    <!-- <link rel="stylesheet" href="css/clock.css"> -->

    <!-- 坐标转换 -->
    <script src="js/coordtransform.js"></script>

    <!-- 其他css -->
    <link rel="stylesheet" type="text/css" href="css/mine.css">
    <script src="js/mine.js"></script>

</head>
<body class="ksh" id='main_body'>
    <!-- 告警信息必须放置在body的头部，并且不能包含在div中 -->
    <div class="md-modal md-effect-1" id="modal-1">
        <div class="md-content">
            <h3 id='warning_detail_head'>告警详情1</h3>
            <div>
                <p>车辆告警详情:</p>
                <ul>
                    <li><strong>危险程度:</strong> 危险.</li>
                    <li><strong>位置:</strong> xxxx, xxxx.</li>
                    <li><strong>详情:</strong> xxxxxx.</li>
                </ul>
                <button class="md-close">关闭</button>
                <button onclick="removeButton('warning_button_1')">处理完成</button>
            </div>
        </div>
    </div>
    <div class="md-modal md-effect-1" id="modal-2">
        <div class="md-content">
            <h3>告警详情2</h3>
            <div>
                <p>车辆告警详情:</p>
                <ul>
                    <li><strong>危险程度:</strong> 危险.</li>
                    <li><strong>位置:</strong> xxxx, xxxx.</li>
                    <li><strong>详情:</strong> xxxxxx.</li>
                </ul>
                <button class="md-close">Close me!</button>
            </div>
        </div>
    </div>
    
    <div id="load">
        <div class="load_img">
            <!-- 加载动画 -->
            <img class="jzxz1" src="images/jzxz1.png">
            <img class="jzxz2" src="images/jzxz2.png">
        </div>
    </div>
    <div class="head_top"><span>智能车监管大数据平台</span></div>
    <div class="visual">
        <div class="visual_left">
            <div class="visual_box flip_card">
                <div class="flip_card_side flip_card_front_side">
                    <div class="visual_title">
                        <span>车辆累计行驶里程/时长</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main1_1">

                    </div>
                </div>

                <div class="flip_card_side flip_card_back_side">
                    <div class="visual_title">
                        <span>单车每日里程/时长</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main1_2">
    
                    </div>
                </div>
            </div>

            <div class="visual_box flip_card">
                <div class="flip_card_side flip_card_front_side">
                    <div class="visual_title">
                        <span>历史车辆状态分布</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main2_1">

                    </div>
                </div>

                <div class="flip_card_side flip_card_back_side">
                    <div class="visual_title">
                        <span>单车每日里程/时长</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main2_2">
    
                    </div>
                </div>
            </div>

            <div class="visual_box">
                <div class="visual_title">
                    <span>告警信息</span>
                    <img src="images/ksh33.png">
                </div>
                <div class="visual_chart" >
                    <!-- 把宽度设大一点，藏住右边的滚动条 -->
                    <div id="warning_button" style="width: 105%; height: 100%; overflow: auto;">
                        <button id="warning_button_1" class="md-trigger" data-modal="modal-1">告警信息1</button>
                        <!-- <button class="md-trigger" data-modal="modal-1">告警信息2</button>
                        <button class="md-trigger" data-modal="modal-1">短</button>
                        <button class="md-trigger" data-modal="modal-1">很长很长的告警信息</button> -->
                    </div>
                </div>
            </div>
        </div>
        <div class="visual_con">
            <div class="visual_conTop">
                <div class="visual_conTop_box visual_conTop1">
                    <div>
                        <h3>今日告警数(起)</h3>
                        <p>67</p>
                        <div class="conTop_smil">
                            <a class="sz">日环比:<span>+3%</span><i class="fa fa-long-arrow-up"></i></a>
                            <a class="xd">周环比:<span>-2%</span><i class="fa fa-long-arrow-down"></i></a>
                        </div>
                    </div>
                </div>
                <div class="visual_conTop_box visual_conTop2">
                    <div>
                        <h3>平均车速(KM/H)</h3>
                        <p id="average_speed">120</p>
                        <div class="conTop_smil">
                            <a class="null">null</a>
                            <a id="average_speed_state" class="">缓行</a>
                        </div>
                    </div>
                </div>
                <div class="visual_conTop_box visual_conTop1">
                    <div>
                        <h3>注册车辆数(辆)</h3>
                        <p>99</p>
                        <div class="conTop_smil">
                            <a class="sz">日环比:<span>+3%</span><i class="fa fa-long-arrow-up"></i></a>
                            <a class="xd">周环比:<span>-2%</span><i class="fa fa-long-arrow-down"></i></a>
                        </div>
                    </div>
                </div>
                <div class="visual_conTop_box visual_conTop2">
                    <div>
                        <h3>累计安全行驶里程(KM)</h3>
                        <p>7421</p>
                        <div class="conTop_smil">
                            <a class="null">null</a>
                            <a class="xd">月环比:<span>-2%</span><i class="fa fa-long-arrow-down"></i></a>
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
            <div class="visual_conBot">
                <img class="visual_conBot_l" src="images/ksh42.png">
                <img class="visual_conBot_2" src="images/ksh43.png">
                <img class="visual_conBot_3" src="images/ksh44.png">
                <img class="visual_conBot_4" src="images/ksh45.png">
                <div class="visual_chart_text">
                    <!-- <h1>出行服务+大数据</h1>
                    <h2>山西省交通大数据分析平台</h2> -->
                </div>
                <div class="visual_chart" id="main5"></div>
                <div class="visual_conBot_bot">
                    <div class="visualSssf_left">
                        <span style="font-size: 20px;">
                            向我展示
                            <div class="ui inline search dropdown" style="font-size: 20px;">
                                <div class="text" >
                                    全局信息
                                </div>
                                <i class="dropdown icon"></i>
                                <div class="menu" id="vin_menu">
                                    <div class="item" style="font-size: 20px;" onclick="backToBackground()">
                                        全局信息
                                    </div>
                                    <!-- <div class="item" style="font-size: 20px;">
                                        LL3ACCJ22JA011664
                                    </div>
                                    <div class="item" style="font-size: 20px;">
                                        12562041260147852
                                    </div> -->
                                </div>
                            </div>
                            
                        </span>

                        
                        <!-- <div class="ui animated button" onclick="onClickSearchButton()" style="vertical-align: middle;">
                            <div class="visible content">单车查询模式</div>
                            <div class="hidden content"><i class="compass icon"></i></div>
                        </div>  
                        <br />
                        <select class="ui search selection dropdown inverted blue" id="search-select" onchange="vinChange()" style="background-color: aqua;"> 
                            <option value="LL3ACCJ22JA011664">LL3ACCJ22JA011664</option>
                            <option value="12562041260147852">12562041260147852</option>        
                        </select> -->
                    </div>
                    <div class="visualSssf_right">
                        <div class="visualSssf_right_box" id="main6_1"></div>
                        <div class="visualSssf_right_box" id="main6_2"></div>
                        <div class="visualSssf_right_box" id="main6_3"></div>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <div class="visual_right">
            <div class="visual_box flip_card">
                <div class="flip_card_side flip_card_front_side">
                    <div class="visual_title">
                        <span>近30天告警信息分布</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main7_1">

                    </div>
                </div>

                <div class="flip_card_side flip_card_back_side">
                    <div class="visual_title">
                        <span>单车近30天告警信息分布</span>
                        <img src="images/ksh33.png">
                    </div>
                    <div class="visual_chart" id="main7_2">
    
                    </div>
                </div>
            </div>

            <div class="visual_box visualSfzsfl">
                <div class="visual_title">
                    <span>低电量行驶区域指数</span>
                    <img src="images/ksh33.png">
                </div>
                <div class="visual_chart" id="main8">

                </div>
            </div>
            <div class="visual_box">
                <div class="visual_title">
                    <span>车内摄像头直播<a id="liveButton" href="javascript:void(0)" onclick="switchToLive()" style="color: white;" class="title_link"><i class="external square alternate icon"></i></a></span>
                    <img src="images/ksh33.png">
                </div>
                <!-- <div class="swiper-container visual_swiper2 visual_chart">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" id="main4"></div>
                        <div class="swiper-slide" id="main41"></div>
                    </div>
                </div> -->
            </div>
        </div>
        <div class="clear"></div>
    </div>

    <!-- <script  src="js/clock.js"></script> -->
    <script>
        var queryLimit = "10000"; //查询时间窗口

    </script>

    <script type="text/javascript" src="js/subfig_2.js"></script>
    <script type="text/javascript" src="js/baiduMap.js"></script>

    <script>
        function onClickMenu(e){
            vin = $(e).text().split(' ')[0]
            console.log('click: '+vin)

            curCarVin = vin;

            // 网页结构修改，不再需要单车模式
            // sunfigEnterSingle();
            // requestSingleCarSpeed();
            // do_initRequestSingleCar(vin);
        }

        function backToBackground(){
            subfigBackToBackground();
            shouldMapGlobal = true;
            map.clearOverlays();
            backgroundRequest();
        }
    </script>

    <script type="text/javascript">
        $(function () {
            var a = $('.visualSssf_left a')
            for (var i = 0; i < a.length; i++) {
                a[i].index = i;
                a[i].onclick = function () {
                    for (var i = 0; i < a.length; i++) {
                        a[i].className = ''
                    }
                    this.className = 'active'
                }
            }

            var sfzcllH = $('.sfzcll_box').height()
            var sfzcllHtwo = sfzcllH - 2
            $('.sfzcll_box').css('line-height', sfzcllH + 'px')
            $('.sfzcll_smallBk>div').css('line-height', sfzcllHtwo + 'px')

            //删除加载动画
            $('#load').fadeOut(1000)
            setTimeout(function () {
                $('#load').remove()
            }
    		, 1100);
        })

        //第一列第一行，行驶里程/时长
        var myChart1_1 = echarts.init(document.getElementById('main1_1'));
        myChart1_1.setOption(option_global_mile_time);
        // var myChart1_2 = init_echarts(document.getElementById('main1_2'), option1);
        var myChart1_2 = echarts.init(document.getElementById('main1_2'));
        myChart1_2.setOption(option_single_mile_time);

        //第一列第二行，状态分布折线图
        var myChart2_1 = echarts.init(document.getElementById('main2_1'));
        myChart2_1.setOption(option2);

        init_subfig_2_2();

        //第三列第一行，本月发生事件
        var myChart7_1 = echarts.init(document.getElementById('main7_1'));
        myChart7_1.setOption(option3);
        var myChart7_2 = echarts.init(document.getElementById('main7_2'));
        myChart7_2.setOption(option31);
        // var mySwiper1 = new Swiper('.visual_swiper1', {
        //     autoplay: true,//可选选项，自动滑动
        //     speed: 800,//可选选项，滑动速度
        //     autoplay: {
        //         delay: 5000,//1秒切换一次
        //     },
        // })

        //收费站收费排行
        // var myChart4 = echarts.init(document.getElementById('main4'));
        // myChart4.setOption(option4);
        // var myChart41 = echarts.init(document.getElementById('main41'));
        // myChart41.setOption(option41);
        // var mySwiper2 = new Swiper('.visual_swiper2', {
        //     autoplay: true,//可选选项，自动滑动
        //     direction: 'vertical',//可选选项，滑动方向
        //     speed: 2000,//可选选项，滑动速度
        // })

        //今日实时收费
        var myChart6_1 = echarts.init(document.getElementById('main6_1'));
        myChart6_1.setOption(option5);
        var myChart6_2 = echarts.init(document.getElementById('main6_2'));
        myChart6_2.setOption(option6);
        var myChart6_3 = echarts.init(document.getElementById('main6_3'));
        myChart6_3.setOption(option7);
        //中间地图
        // var myChart5 = echarts.init(document.getElementById('main5'));
        // myChart5.setOption(option8);

        //低电量行驶区域指数
        var myChart8 = echarts.init(document.getElementById('main8'));
        myChart8.setOption(option9);

        // *display属性为none的时候echarts图表无法绘制，所以先画完图再统一设置display
        init_card_side_display();
    </script>

    <!-- 弹出式窗口 -->
    <div class="md-overlay"></div><!-- the overlay element -->

    <!-- classie.js by @desandro: https://github.com/desandro/classie -->
    <script src="js/classie.js"></script>
    <script src="js/modalEffects.js"></script>

    <!-- for the blur effect -->
    <!-- by @derSchepp https://github.com/Schepp/CSS-Filters-Polyfill -->
    <script>
        // this is important for IEs
        var polyfilter_scriptpath = '/js/';
    </script>
    <script src="js/cssParser.js"></script>
    <script src="js/css-filters-polyfill.js"></script>

    

</body>
</html>


<script type="text/javascript">
    $('.ui.dropdown').dropdown();
</script>

<script>
    function getVinList(){
        $.ajax({
            
            url: server_ip+'api/current_vin', //请求的url
            type: 'get', //请求的方式
            error: function (data) {
                console.log('getVinList请求失败');
            },
            success: function (data) {

                console.log('getVinList请求成功');
                console.log(data);

                var obj = document.getElementById("vin_menu");

                for(var i = 0; i < data.length; ++i){
                    var new_tex = document.createElement("div");
                    new_tex.setAttribute("class", "item");
                    new_tex.setAttribute("style", "font-size: 20px;");
                    new_tex.setAttribute("onclick", "onClickMenu(this)");
                    new_tex.innerHTML = data[i];
                    obj.appendChild(new_tex);
                }
            }
        });

    }
</script>

<script>
    getVinList();

    setTimeout(function(){
        backgroundRequest();
    }, 1000);

    // dashboard
    requestTotalCarNum();
    setTimeout(function(){
        requestOnCarNum();
    }, 100);

    // scoreboard
    requestAverageSpeed();

</script>

<script>
    function add_warning(){
        $('#warning_button').prepend('<button id="warning_button_3" class="md-trigger" data-modal="modal-3">插入告警信息测试</button>')
        $('#main_body').prepend('<div class="md-modal md-effect-1" id="modal-3"><div class="md-content"><h3>插入告警信息测试</h3><div><p>车辆告警详情:</p><ul><li><strong>危险程度:</strong> 危险.</li><li><strong>位置:</strong> xxxx, xxxx.</li><li><strong>详情:</strong> xxxxxx.</li></ul><button class="md-close">关闭</button> <button onclick="removeButton(\'warning_button_3\')">处理完成</button></div></div></div>')
        // 新插入的弹出式窗口需要重新初始化
        re_init_pop_window()
    }

    setTimeout(function(){
        add_warning();
    }, 5000);
</script>